var API_URL="https://api.decentrafly.org/0/me";window.decentrafly_api_me={};const FALLBACK_DATA={global:{aircraft:"1,234",beast:"567",mlat:"89"},clients:{beast:[],mlat:[]}};function updateTable(){aircraft=document.getElementById("decentrafly_api_me_aircraft"),aircraft.innerHTML=window.decentrafly_api_me.global?.aircraft||FALLBACK_DATA.global.aircraft,beast=document.getElementById("decentrafly_api_me_beast"),beast.innerHTML=window.decentrafly_api_me.global?.beast||FALLBACK_DATA.global.beast,mlat=document.getElementById("decentrafly_api_me_mlat"),mlat.innerHTML=window.decentrafly_api_me.global?.mlat||FALLBACK_DATA.global.mlat,cells=["uuid","ms","kbps","connected_seconds","positions","messages_per_second","positions_per_second"];for(var e,t,s,o,n=0;n<(window.decentrafly_api_me.clients?.beast||FALLBACK_DATA.clients.beast).length;n++)if(s=(window.decentrafly_api_me.clients?.beast||FALLBACK_DATA.clients.beast)[n],t=document.getElementById("decentrafly_api_me_beast_table").rows[n+1],t)for(e=0;e<cells.length;e++)t.cells[e].innerHTML!=s[cells[e]]&&(t.cells[e].classList.add("decentrafly_blink"),t.cells[e].innerHTML=s[cells[e]],e==0&&t.cells[e].classList.add("aloltooltiptext"));else{t=document.getElementById("decentrafly_api_me_beast_table").insertRow(n+1);for(e=0;e<cells.length;e++)o=t.insertCell(e),o.innerHTML=s[cells[e]],e==0&&o.classList.add("aloltooltiptext")}for(;document.getElementById("decentrafly_api_me_beast_table").rows.length>(window.decentrafly_api_me.clients?.beast||FALLBACK_DATA.clients.beast).length+1;)document.getElementById("decentrafly_api_me_beast_table").deleteRow((window.decentrafly_api_me.clients?.beast||FALLBACK_DATA.clients.beast).length+1);cells=["user","peer_count","bad_sync_timeout"];for(n=0;n<(window.decentrafly_api_me.clients?.mlat||FALLBACK_DATA.clients.mlat).length;n++)if(s=(window.decentrafly_api_me.clients?.mlat||FALLBACK_DATA.clients.mlat)[n],t=document.getElementById("decentrafly_api_me_mlat_table").rows[n+1],t)for(e=0;e<cells.length;e++)t.cells[e].innerHTML!=s[cells[e]]&&(t.cells[e].classList.add("decentrafly_blink"),t.cells[e].innerHTML=s[cells[e]]);else{t=document.getElementById("decentrafly_api_me_mlat_table").insertRow(n+1);for(e=0;e<cells.length;e++)o=t.insertCell(e),o.innerHTML=s[cells[e]],e==0&&o.classList.add("aloltooltiptext")}for(;document.getElementById("decentrafly_api_me_mlat_table").rows.length>(window.decentrafly_api_me.clients?.mlat||FALLBACK_DATA.clients.mlat).length+1;)document.getElementById("decentrafly_api_me_mlat_table").deleteRow((window.decentrafly_api_me.clients?.mlat||FALLBACK_DATA.clients.mlat).length+1);(window.decentrafly_api_me.clients?.mlat||FALLBACK_DATA.clients.mlat).length>0&&(document.getElementById("decentrafly_api_me_mlat_table").classList.remove("d-none"),document.getElementById("decentrafly_api_me_feeding_info").classList.remove("d-none"),document.getElementById("decentrafly_api_me_footer").innerHTML="❤️"),(window.decentrafly_api_me.clients?.beast||FALLBACK_DATA.clients.beast).length>0&&(document.getElementById("decentrafly_api_me_beast_table").classList.remove("d-none"),document.getElementById("decentrafly_api_me_feeding_info").classList.remove("d-none"))}window.decentrafly_api_me_update=function(){fetch(API_URL).then(e=>e.json()).then(e=>{window.decentrafly_api_me=e,updateTable()}).catch(e=>{console.log("API unavailable, using fallback data:",e),window.decentrafly_api_me=FALLBACK_DATA,updateTable()})},document.addEventListener("DOMContentLoaded",function(){setInterval(window.decentrafly_api_me_update,5e3),window.decentrafly_api_me_update()})